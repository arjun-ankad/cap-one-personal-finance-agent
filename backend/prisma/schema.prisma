generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                   Int           @id @default(autoincrement())
  customerId           Int           @unique @map("customer_id")
  email                String        @unique @db.VarChar(255)
  passwordHash         String        @map("password_hash") @db.VarChar(255)
  firstName            String        @map("first_name") @db.VarChar(100)
  lastName             String        @map("last_name") @db.VarChar(100)
  age                  Int?
  gender               String?       @db.VarChar(20)
  accountType          String?       @map("account_type") @db.VarChar(50)
  dateOfAccountOpening DateTime?     @map("date_of_account_opening") @db.Date
  creditLimit          Decimal?      @map("credit_limit") @db.Decimal(10, 2)
  loanId               Int?          @map("loan_id")
  cardId               Int?          @map("card_id")
  createdAt            DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt            DateTime?     @default(now()) @updatedAt @map("updated_at") @db.Timestamp(6)
  creditCards          CreditCard[]
  feedback             Feedback[]
  loans                Loan[]
  sessions             Session[]
  transactions         Transaction[]

  @@map("users")
}

model Session {
  id               Int       @id @default(autoincrement())
  userId           Int?      @map("user_id")
  refreshTokenHash String    @map("refresh_token_hash") @db.VarChar(255)
  expiresAt        DateTime  @map("expires_at") @db.Timestamp(6)
  createdAt        DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  user             User?     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([expiresAt], map: "idx_sessions_expires")
  @@index([userId], map: "idx_sessions_user")
  @@map("sessions")
}

model Transaction {
  id                             Int       @id @default(autoincrement())
  customerId                     Int?      @map("customer_id")
  transactionId                  Int       @unique @map("transaction_id")
  transactionDate                DateTime  @map("transaction_date") @db.Date
  transactionType                String    @map("transaction_type") @db.VarChar(50)
  category                       String?   @db.VarChar(50)
  merchant                       String?   @db.VarChar(255)
  transactionAmount              Decimal   @map("transaction_amount") @db.Decimal(10, 2)
  accountBalanceAfterTransaction Decimal   @map("account_balance_after_transaction") @db.Decimal(10, 2)
  lastTransactionDate            DateTime? @map("last_transaction_date") @db.Date
  anomaly                        Int?      @default(0)
  createdAt                      DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  user                           User?     @relation(fields: [customerId], references: [customerId], onDelete: Cascade, onUpdate: NoAction)

  @@index([customerId, transactionDate], map: "idx_transactions_customer_date")
  @@index([transactionDate], map: "idx_transactions_date")
  @@map("transactions")
}

model CreditCard {
  id                        Int       @id @default(autoincrement())
  customerId                Int?      @map("customer_id")
  recordDate                DateTime  @map("record_date") @db.Date
  cardType                  String?   @map("card_type") @db.VarChar(50)
  creditLimit               Decimal?  @map("credit_limit") @db.Decimal(10, 2)
  creditCardBalance         Decimal?  @map("credit_card_balance") @db.Decimal(10, 2)
  minimumPaymentDue         Decimal?  @map("minimum_payment_due") @db.Decimal(10, 2)
  paymentDueDate            DateTime? @map("payment_due_date") @db.Date
  lastCreditCardPaymentDate DateTime? @map("last_credit_card_payment_date") @db.Date
  rewardsPoints             Int?      @default(0) @map("rewards_points")
  createdAt                 DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  user                      User?     @relation(fields: [customerId], references: [customerId], onDelete: Cascade, onUpdate: NoAction)

  @@index([customerId, recordDate], map: "idx_credit_cards_customer_date")
  @@map("credit_cards")
}

model Loan {
  id                    Int       @id @default(autoincrement())
  customerId            Int?      @map("customer_id")
  recordDate            DateTime  @map("record_date") @db.Date
  loanAmount            Decimal?  @map("loan_amount") @db.Decimal(10, 2)
  loanType              String?   @map("loan_type") @db.VarChar(50)
  interestRate          Decimal?  @map("interest_rate") @db.Decimal(5, 2)
  loanTerm              Int?      @map("loan_term")
  approvalRejectionDate DateTime? @map("approval_rejection_date") @db.Date
  loanStatus            String?   @map("loan_status") @db.VarChar(50)
  createdAt             DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  user                  User?     @relation(fields: [customerId], references: [customerId], onDelete: Cascade, onUpdate: NoAction)

  @@index([customerId, recordDate], map: "idx_loans_customer_date")
  @@map("loans")
}

model Feedback {
  id               Int       @id @default(autoincrement())
  customerId       Int?      @map("customer_id")
  feedbackId       Int       @unique @map("feedback_id")
  feedbackDate     DateTime  @map("feedback_date") @db.Date
  feedbackType     String?   @map("feedback_type") @db.VarChar(50)
  resolutionStatus String?   @map("resolution_status") @db.VarChar(50)
  resolutionDate   DateTime? @map("resolution_date") @db.Date
  anomaly          Int?      @default(0)
  createdAt        DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  user             User?     @relation(fields: [customerId], references: [customerId], onDelete: Cascade, onUpdate: NoAction)

  @@map("feedback")
}
